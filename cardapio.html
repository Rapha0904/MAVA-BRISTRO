<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cardápio - Mava Baristro</title>

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* PALETA */
:root{
    --azul:#0a0f2e;
    --dourado:#b88a55;
    --cinza:#f4f4f4;
    --branco:#ffffff;
    --gold-light: #ccaa77;
}

/* GLOBAL */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:Arial, sans-serif;
}

body{
    background:var(--cinza);
    color:var(--azul);
    overflow-x:hidden;
}

/* ================= HEADER ================= */
header{
    background:var(--azul);
    color:var(--dourado);
    padding:15px;
    display:flex;
    align-items:center;
    gap:15px;
    border-bottom:4px solid var(--dourado);
}

header img{
    width:60px;
    height:60px;
    border-radius:50%;
    border:3px solid var(--dourado);
    object-fit:cover;
}

header h1{
    font-size:22px;
    font-weight:bold;
}

/* INFO DA MESA */
#mesaInfo{
    background:white;
    padding:10px 15px;
    border-bottom:2px solid var(--dourado);
    font-size:16px;
    font-weight:bold;
    color:var(--azul);
}

/* NAV */
.nav{
    background:white;
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    padding:10px;
    gap:15px;
    border-bottom:2px solid var(--dourado);
}

.nav button{
    background:none;
    border:none;
    color:var(--azul);
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
    padding:6px 10px;
    transition:.3s;
}

.nav button.active{
    border-bottom:3px solid var(--dourado);
}

/* GRID */
.menu-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap:20px;
    padding:15px;
}

/* CARD */
.card{
    background:white;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    padding:12px;
    border:2px solid var(--dourado);
    text-align:center;
}

.card img{
    width:100%;
    height:140px;
    object-fit:cover;
    border-radius:10px;
    margin-bottom:5px;
}

.card button.add{
    background:var(--dourado);
    border:none;
    padding:10px 14px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    margin-top:8px;
    width:100%;
    color:white;
    font-size:15px;
}

/* CARRINHO */
#carrinho{
    position:fixed;
    right:0;
    top:0;
    width:330px;
    height:100vh;
    background:white;
    border-left:4px solid var(--dourado);
    padding:20px;
    transform:translateX(100%);
    transition:.45s;
    overflow-y:auto;
    z-index:999;
}

#btn-carrinho{
    position:fixed;
    right:15px;
    top:15px;
    background:var(--dourado);
    color:white;
    padding:12px 16px;
    border-radius:50%;
    cursor:pointer;
    z-index:1000;
    font-size:22px;
}

.confirmar-btn{
    background:var(--azul);
    color:var(--dourado);
    width:100%;
    border:none;
    padding:12px;
    border-radius:10px;
    margin-top:15px;
    font-weight:bold;
}
</style>
</head>

<body>

<header>
    <img src="logo_mava_baristro.png">
    <h1>Mava Baristro - Cardápio</h1>
</header>

<div id="mesaInfo">Carregando dados da mesa...</div>

<div id="btn-carrinho"><i class="fas fa-shopping-cart"></i></div>

<div class="nav">
    <button class="active" data-cat="cafes">Cafés</button>
    <button data-cat="bebidas">Bebidas</button>
    <button data-cat="doces">Doces</button>
    <button data-cat="salgados">Salgados</button>
</div>

<div class="menu-grid" id="grid"></div>

<div id="carrinho">
    <h2>Carrinho</h2>
    <ul id="lista-itens"></ul>
    <h3 id="total">Total: R$ 0,00</h3>

    <button class="confirmar-btn" id="confirmar">Confirmar Pedido</button>
</div>

<script type="module">
import { db } from "./ADMINISTRATIVO/firebase.js";
import { ref, onValue, push } 
    from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

/* ================= LEITURA DA MESA VIA URL ================= */
const urlParams = new URLSearchParams(window.location.search);
const mesaID = urlParams.get("mesa");

const mesaInfo = document.getElementById("mesaInfo");

if(!mesaID){
    mesaInfo.innerHTML = "❌ Mesa inválida. Use o QR Code correto.";
}

/* ================= VERIFICAÇÃO DA MESA NO FIREBASE ================= */
let clientesMesa = [];

onValue(ref(db, "mesas/" + mesaID), snap=>{
    if(!snap.exists()){
        mesaInfo.innerHTML = `Mesa ${mesaID} não configurada.`;
        return;
    }

    const dados = snap.val();
    clientesMesa = dados.clientes || [];

    if(dados.status === "livre"){
        mesaInfo.innerHTML = `
            Mesa ${mesaID} — <span style="color:red;font-weight:bold;">Aguardando cadastro</span>
        `;
    } else {
        mesaInfo.innerHTML = `
            ✔️ Bem-vindo(a), <b>${clientesMesa[0]}</b> — Mesa <b>${mesaID}</b>
        `;
    }
});

/* ================= CARRINHO ================= */
let total = 0;
let itens = [];

const carrinho = document.getElementById("carrinho");
document.getElementById("btn-carrinho").onclick = ()=>{
    carrinho.style.transform =
        carrinho.style.transform === "translateX(0%)"
        ? "translateX(100%)"
        : "translateX(0%)";
};

/* ================= CARREGAR PRODUTOS ================= */
const grid = document.getElementById("grid");
let categoriaAtual = "cafes";

function carregarProdutos(){
    onValue(ref(db, "produtos"), snap=>{
        grid.innerHTML = "";

        snap.forEach(item=>{
            const p = item.val();
            if(p.categoria !== categoriaAtual) return;

            grid.innerHTML += `
                <div class="card">
                    <img src="${p.foto}">
                    <h3>${p.nome}</h3>
                    <p>R$ ${p.preco}</p>
                    <p>${p.quantidade || ""}</p>
                    <button class="add"
                        data-nome="${p.nome}"
                        data-preco="${p.preco}">
                        + Adicionar
                    </button>
                </div>`;
        });

        activarBotoes();
    });
}
carregarProdutos();

document.querySelectorAll(".nav button").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".nav button")
        .forEach(b=>b.classList.remove("active"));

        btn.classList.add("active");
        categoriaAtual = btn.dataset.cat;
        carregarProdutos();
    };
});

function activarBotoes(){
    document.querySelectorAll(".add").forEach(btn=>{
        btn.onclick = ()=>{
            const nome = btn.dataset.nome;
            const preco = parseFloat(btn.dataset.preco);

            itens.push(nome);
            total += preco;

            const li = document.createElement("li");
            li.innerText = `${nome} — R$ ${preco.toFixed(2)}`;
            document.getElementById("lista-itens").appendChild(li);

            document.getElementById("total").innerText =
                `Total: R$ ${total.toFixed(2)}`;
        };
    });
}

/* ================= ENVIAR PEDIDO ================= */
document.getElementById("confirmar").onclick = ()=>{

    if(clientesMesa.length === 0){
        alert("A mesa ainda não está configurada pelo recepcionista.");
        return;
    }

    if(itens.length === 0){
        alert("Adicione itens ao carrinho!");
        return;
    }

    const pedido = {
        mesa: mesaID,
        nomes: clientesMesa,
        itens: itens,
        total: total,
        status: "novo",
        hora: Date.now()
    };

    push(ref(db, "pedidos"), pedido);

    alert("Pedido enviado com sucesso!");
    location.reload();
};
</script>

</body>
</html>
