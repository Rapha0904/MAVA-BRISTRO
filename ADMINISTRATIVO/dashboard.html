<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Mava Baristro</title>

<link rel="stylesheet" href="admin.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* ===== GRID CARDS ===== */
.dash-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(260px,1fr));
    gap:22px;
    margin-top:25px;
}

.dash-card{
    background:white;
    padding:22px;
    border-radius:16px;
    box-shadow:0 3px 12px rgba(0,0,0,0.12);
    border-left:6px solid var(--dourado);
    transition:.3s;
}

.dash-card:hover{
    transform:translateY(-5px);
}

.dash-title{
    font-size:18px;
    font-weight:bold;
    color:var(--azul);
}

.dash-value{
    font-size:34px;
    margin-top:12px;
    font-weight:bold;
    color:var(--azul);
}

/* ===== BEM-VINDO ===== */
.welcome-card{
    background:white;
    padding:22px;
    border-radius:16px;
    box-shadow:0 3px 12px rgba(0,0,0,0.10);
    margin-bottom:25px;
    border-left:6px solid var(--dourado);
}

.welcome-card h2{
    margin:0;
    font-size:22px;
    color:var(--azul);
}

.welcome-card p{
    margin-top:6px;
    font-size:16px;
}
</style>
</head>

<body>

<!-- BTN MOBILE -->
<div class="menu-toggle" onclick="toggleMenu()">
    <i class="fas fa-bars"></i>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">

    <h2>Mava Baristro</h2>

    <div class="menu-item active" onclick="go('dashboard.html')">
        <i class="fas fa-chart-line"></i> Dashboard
    </div>

    <div class="menu-item" onclick="go('produtos.html')">
        <i class="fas fa-mug-hot"></i> Produtos
    </div>

    <div class="menu-item" onclick="go('cozinha.html')">
        <i class="fas fa-kitchen-set"></i> Cozinha
    </div>

    <div class="menu-item" onclick="go('caixa.html')">
        <i class="fas fa-cash-register"></i> Caixa
    </div>

    <div class="menu-item" onclick="go('mesas.html')">
        <i class="fas fa-chair"></i> Mesas
    </div>

    <div class="menu-item" onclick="go('colaboradores.html')">
        <i class="fas fa-users"></i> Colaboradores
    </div>

    <div class="menu-item" onclick="logout()">
        <i class="fas fa-door-open"></i> Sair
    </div>

</div>

<!-- CONTEÚDO -->
<div class="content">

    <!-- ==== BEM-VINDO ==== -->
    <div class="welcome-card">
        <h2 id="welcomeTitle">Bem-vindo ao painel!</h2>
        <p>Aqui você acompanha pedidos, colaboradores, produtos e mesas.</p>
    </div>

    <h1 class="title">Dashboard Administrativo</h1>

    <div class="dash-grid">
        
        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-receipt"></i> Pedidos do dia</div>
            <div class="dash-value" id="totalPedidos">0</div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-cash-register"></i> Total vendido (R$)</div>
            <div class="dash-value" id="totalVendas">0,00</div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-chair"></i> Mesas Livres</div>
            <div class="dash-value" id="mesasLivres">0</div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-chair"></i> Mesas Ocupadas</div>
            <div class="dash-value" id="mesasOcupadas">0</div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-users"></i> Colaboradores</div>
            <div class="dash-value" id="totalColaboradores">0</div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><i class="fas fa-box"></i> Produtos cadastrados</div>
            <div class="dash-value" id="totalProdutos">0</div>
        </div>

    </div>

</div>

<!-- FIREBASE -->
<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
    ref,
    onValue
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

/* LOGIN */
onAuthStateChanged(auth, user => {
    if (!user) window.location.href = "../login.html";
    else document.getElementById("welcomeTitle").innerText =
        "Bem-vindo ao painel, " + user.email;
});

window.logout = () => signOut(auth);

/* ========= PEDIDOS DO DIA ========= */
onValue(ref(db, "pedidos"), snap => {

    let pedidosHoje = 0;
    let valorTotal  = 0;
    const hoje = new Date();

    snap.forEach(item => {
        const p = item.val();
        if (!p.hora) return;

        const d = new Date(p.hora);

        if (
            d.getDate() === hoje.getDate() &&
            d.getMonth() === hoje.getMonth() &&
            d.getFullYear() === hoje.getFullYear()
        ) {
            pedidosHoje++;
            valorTotal += Number(p.total || 0);
        }
    });

    document.getElementById("totalPedidos").innerText = pedidosHoje;
    document.getElementById("totalVendas").innerText =
        valorTotal.toFixed(2).replace(".", ",");
});

/* ========= MESAS ========= */
onValue(ref(db, "mesas"), snap => {

    let livres = 0;
    let ocupadas = 0;

    snap.forEach(item => {
        const mesa = item.val();
        if (!mesa || !mesa.status) return;

        if (mesa.status === "livre") livres++;
        else ocupadas++;
    });

    document.getElementById("mesasLivres").innerText   = livres;
    document.getElementById("mesasOcupadas").innerText = ocupadas;
});

/* ========= PRODUTOS (CORRIGIDO) ========= */
onValue(ref(db, "produtos"), snap => {

    if (!snap.exists()) {
        document.getElementById("totalProdutos").innerText = 0;
        return;
    }

    let total = 0;
    snap.forEach(() => total++);

    document.getElementById("totalProdutos").innerText = total;
});

/* ========= COLABORADORES ========= */
onValue(ref(db, "colaboradores"), snap => {
    document.getElementById("totalColaboradores").innerText =
        snap.numChildren();
});
</script>

<script>
function go(p){ window.location.href = p; }
function toggleMenu(){
    document.getElementById("sidebar").classList.toggle("active");
}
</script>

</body>
</html>
